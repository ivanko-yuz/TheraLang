piranha.media=new Vue({el:"#media",data:{loading:!0,listView:!0,currentFolderId:null,parentFolderId:null,folders:[],items:[],folder:{name:null},dropzone:null},methods:{drag:function(e,a){e.dataTransfer.setData("mediaId",a.id)},dragover:function(e){e.preventDefault();var a=$(e.target).closest(".droppable");a.hasClass("active")||a.addClass("active")},dragleave:function(e){e.preventDefault();var a=$(e.target).closest(".droppable");a.hasClass("active")&&a.removeClass("active")},drop:function(e,a){e.preventDefault();var n=$(e.target).closest(".droppable");n.hasClass("active")&&n.removeClass("active");var i=e.dataTransfer.getData("mediaId");fetch(piranha.baseUrl+"manager/api/media/move/"+i+"/"+(a||"")).then(function(e){return e.json()}).then(function(e){"success"===e.type&&piranha.media.refresh(),piranha.notifications.push(e)}).catch(function(e){console.log("error:",e)})},showList:function(){this.listView=!0},showGallery:function(){this.listView=!1},load:function(e){var a=this;fetch(piranha.baseUrl+"manager/api/media/list"+(e?"/"+e:"")+"/?width=210&height=160").then(function(e){return e.json()}).then(function(e){a.currentFolderId=e.currentFolderId,a.parentFolderId=e.parentFolderId,a.folders=e.folders,a.items=e.media,a.listView="list"===e.viewMode}).catch(function(e){console.log("error:",e)})},getThumbnailUrl:function(e){return null!==e.altVersionUrl?e.altVersionUrl:piranha.baseUrl+"manager/api/media/url/"+e.id+"/210/160"},refresh:function(){piranha.media.load(piranha.media.currentFolderId)},savefolder:function(){var e=document.getElementById("mediaFolderForm");!1!==e.checkValidity()?fetch(piranha.baseUrl+"manager/api/media/folder/save",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({parentId:piranha.media.currentFolderId,name:piranha.media.folder.name})}).then(function(e){return e.json()}).then(function(e){"success"===e.status.type&&($("#mediaFolderModal").modal("hide"),piranha.media.folder.name=null,piranha.media.folders=e.folders,piranha.media.items=e.media),piranha.notifications.push(e.status)}).catch(function(e){console.log("error:",e)}):e.classList.add("was-validated")},remove:function(e){fetch(piranha.baseUrl+"manager/api/media/delete/"+e).then(function(e){return e.json()}).then(function(e){piranha.media.folders=e.folders,piranha.media.items=e.media,piranha.notifications.push(e.status)}).catch(function(e){console.log("error:",e)})},removeFolder:function(e){fetch(piranha.baseUrl+"manager/api/media/folder/delete/"+e).then(function(e){return e.json()}).then(function(e){piranha.media.folders=e.folders,piranha.notifications.push(e.status)}).catch(function(e){console.log("error:",e)})}},updated:function(){this.loading&&(piranha.permissions.media.add&&(this.dropzone=piranha.dropzone.init("#media-upload-container",{uploadMultiple:!1}),this.dropzone.on("complete",function(e){"success"===e.status&&setTimeout(function(){piranha.media.dropzone.removeFile(e)},3e3)}),this.dropzone.on("queuecomplete",function(){piranha.media.refresh()})),this.loading=!1)}}),$(document).on("shown.bs.modal","#mediaFolderModal",function(e){$("#mediaFolderName").focus()});